<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Discover</title>
  <link rel="stylesheet" href="/styles/style.css" />
  <link rel="stylesheet" href="/styles/variables.css" />
  <link rel="stylesheet" href="/styles/custom-chart.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body class="m-0 p-0">
  <div class="d-flex" style="height: 100vh;">
    <!-- Sidebar -->
    <%- include('partials/sidebar') %>

    <!-- Main Content -->
    <div class="flex-grow-1 d-flex flex-column" style="overflow-y: auto;">
      <!-- Top Bar -->
      <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
        <!-- <div class="flex-grow-1 px-4">
          <input type="search" class="form-control" placeholder="Login for more content..." />
        </div> -->
        <%- include('partials/header.ejs') %>
        <%- include('partials/searchUserResults.ejs') %>

        <div class="px-4">
          <!-- <a href="#">Create Center</a> -->
        </div>
      </div>

      <!-- Content Body -->
      <div class="container py-4">
        <!-- Hot Tags -->
       
        <section class="mb-5">
          <h2>Hot Tags</h2>
          <div class="tag-list">
            <% hotTags.forEach(t => { %>
              <button
                type="button"
                class="btn btn-outline-secondary btn-sm me-2 mb-2"
                onclick="location.href='/tags/<%= encodeURIComponent(t.name) %>'"
              >
                #<%= t.name %>
              </button>
            <% }) %>
          </div>
        </section>

      <!-- Trending & Popular This Week -->
<section class="mb-5">
  <div class="row g-4">


    <!-- 2. Popular This Week：按钮列表 -->
    <div class="col-md-6">
      <h2>Popular This Week</h2>
       <p class="text-muted">Tags trending in past 7 days</p>
        <div class="tag-list">
          <% weeklyTags.forEach(t => { %>
            <button type="button"
                    class="btn btn-outline-secondary btn-sm me-2 mb-2"
                    onclick="location.href='/tags/<%= encodeURIComponent(t) %>'">
              #<%= t %>
            </button>
          <% }) %>
        </div>
    </div>
    <!-- 1. Trending Tags：表格+“小条” -->
    <div class="col-md-6">
      <h2>Trending Tags</h2>
      <p class="text-muted">Tag clicks over the past 7 days</p>
      <div style="height:300px;">
        <canvas id="trendChart"></canvas>
      </div>



    </div>

    
  </div>
</section>





      
        <!-- Featured Posts -->
        <section>
          <h2>Featured Posts</h2>
          <div class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-4">
            <% if (posts && posts.length > 0) { %>
            <% posts.forEach(post => { %>
              <%- include('partials/postCardGrid', { post, currentUser }) %>
            <% }) %>
          <% } else { %>
            <div class="col">
              <p>No posts yet. Upload your first sewing project!</p>
            </div>
          <% } %>
          </div>
          
        </section>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
  <!-- <script src="/public/js/router.js"></script> -->
  <!-- <script src="../js/router.js"></script> -->
  <script src="/js/index.js"></script>
  <script>
  const days = <%- JSON.stringify(trendingViews.days) %>;
  const datasets = <%- JSON.stringify(
    trendingViews.tags.map((t,i) => ({
      label: `#${t.name}`,
      data: t.counts,
      borderColor: ['#E89DA0','#88CEE6','#F6C8A8','#B2D3A4','#B696B6'][i],
      fill: false,
      tension: 0.3
    }))
  ) %>;

  new Chart(document.getElementById('trendChart').getContext('2d'), {
    type: 'line',
    data: { labels: days, datasets },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: 20 },
      plugins: {
        legend: { position: 'right' },
        tooltip: { mode: 'index', intersect: false }
      },
      scales: {
        x: { grid:{ color:'#eee' }, ticks:{ color:'#555' } },
        y: { grid:{ color:'#eee' }, ticks:{ color:'#555', beginAtZero:true } }
      },
      elements: { line:{ borderWidth:2 }, point:{ radius:4 } }
    }
  });
</script>

</body>
</html>
