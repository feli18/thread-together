<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Metrics</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-4">
  <div class="container-fluid">
    <h3 class="mb-3">Metrics</h3>

    <div class="row g-4 mb-4">
      <div class="col-md-3">
        <div class="p-3 border rounded">
          <div class="text-muted">Suggested</div>
          <div class="fs-4"><%= suggested %></div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="p-3 border rounded">
          <div class="text-muted">Accepted</div>
          <div class="fs-4"><%= accepted %></div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="p-3 border rounded">
          <div class="text-muted">Edited</div>
          <div class="fs-4"><%= edited %></div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="p-3 border rounded">
          <div class="text-muted">Removed</div>
          <div class="fs-4"><%= removed %></div>
        </div>
      </div>
    </div>

    <div class="row g-4">
      <div class="col-md-6">
        <div class="p-3 border rounded">
          <h5>Acceptance Rate</h5>
          <div class="fs-4"><%= (acceptanceRate * 100).toFixed(1) %>%</div>
          <canvas id="acceptanceChart" height="120" data-acc="<%= (acceptanceRate * 100).toFixed(1) %>"></canvas>
        </div>
      </div>
      <div class="col-md-6">
        <div class="p-3 border rounded">
          <h5>Mean Tags per Post</h5>
          <div class="fs-4"><%= meanTags %></div>
          <canvas id="meanTagsChart" height="120" data-mean="<%= meanTags %>"></canvas>
        </div>
      </div>
    </div>

    <div class="row g-4 mt-2">
      <div class="col-md-6">
        <div class="p-3 border rounded">
          <h5>Average Completion Time (ms)</h5>
          <div class="fs-4"><%= avgTimeMs %></div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="p-3 border rounded">
          <h5>Trend Concentration (last <%= windowDays %> days)</h5>
          <div class="small text-muted">Top-5 Share / HHI</div>
          <div class="fs-6">Top-5: <%= (top5Share * 100).toFixed(1) %>%</div>
          <div class="fs-6">HHI: <%= hhi.toFixed(3) %></div>
        </div>
      </div>
    </div>

    <div class="row g-4 mt-2">
      <div class="col-md-6">
        <div class="p-3 border rounded">
          <h5>Funnel: Tag → Post</h5>
          <div class="fs-4"><%= (ctrTagToPost * 100).toFixed(1) %>%</div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="p-3 border rounded">
          <h5>Funnel: Post → Interaction</h5>
          <div class="fs-4"><%= (convPostToInteract * 100).toFixed(1) %>%</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const acc = parseFloat(document.getElementById('acceptanceChart').dataset.acc || '0');
    new Chart(document.getElementById('acceptanceChart'), {
      type: 'bar',
      data: { labels: ['Acceptance %'], datasets: [{ label: 'Acceptance', data: [acc], backgroundColor: '#4caf50' }] },
      options: { scales: { y: { beginAtZero: true, max: 100 } } }
    });

    const meanTagsVal = parseFloat(document.getElementById('meanTagsChart').dataset.mean || '0');
    new Chart(document.getElementById('meanTagsChart'), {
      type: 'bar',
      data: { labels: ['Mean Tags'], datasets: [{ label: 'Tags', data: [meanTagsVal], backgroundColor: '#2196f3' }] },
      options: { scales: { y: { beginAtZero: true, suggestedMax: 10 } } }
    });
  </script>
</body>
</html>


